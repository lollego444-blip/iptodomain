<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Batch IP → Domain Resolver</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --primary:#4361ee;--primary-dark:#3a56d4;--secondary:#7209b7;
      --success:#2ecc71;--danger:#e74c3c;--warning:#f39c12;
      --light:#f8f9fa;--dark:#212529;--gray:#6c757d;--border:#e9ecef;
      --radius:12px;--shadow:0 6px 24px rgba(0,0,0,.08);--t:all .25s ease;
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:linear-gradient(135deg,#f5f7fa,#e4edf5);padding:24px;color:var(--dark)}
    .card{max-width:1000px;margin:auto;background:#fff;border-radius:var(--radius);
      box-shadow:var(--shadow);padding:28px;position:relative}
    .card::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--primary),var(--secondary))}
    h1{margin:0 0 8px;font-size:28px;font-weight:800;
      background:linear-gradient(90deg,var(--primary),var(--secondary));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .lead{color:var(--gray);margin-bottom:18px}
    textarea{width:100%;min-height:160px;border:2px solid var(--border);
      border-radius:var(--radius);padding:16px;font-family:monospace;
      transition:var(--t);background:#fafbfc}
    textarea:focus{outline:none;border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(67,97,238,.15)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin:16px 0}
    .controls>*{flex:1 1 180px}
    button,select{border-radius:var(--radius);padding:12px 16px;font-weight:600;
      border:2px solid var(--border);background:#fff;cursor:pointer;transition:var(--t)}
    button.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    button.primary:hover{background:var(--primary-dark)}
    button.ghost:hover{background:var(--border)}
    .results{border:2px solid var(--border);border-radius:var(--radius);overflow:auto;max-height:420px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:14px;border-bottom:1px solid var(--border);font-size:14px}
    th{background:var(--primary);color:#fff;position:sticky;top:0}
    .status.ok{color:var(--success)}
    .status.err{color:var(--danger)}
    .pill{display:inline-block;margin:4px 6px 4px 0;padding:6px 12px;border-radius:20px;
      background:#eef2ff;color:var(--primary);border:1px solid #dbe4ff}
    .stats{display:flex;gap:16px;margin-top:16px;background:#f8f9fa;
      padding:14px;border-radius:var(--radius)}
    .stat{text-align:center}
    .stat b{display:block;font-size:20px;color:var(--primary)}
    .alerts{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px}
    .alert{background:#fff;border-left:4px solid var(--primary);padding:12px 16px;
      border-radius:var(--radius);box-shadow:var(--shadow)}
    @media(max-width:768px){body{padding:16px}.controls{flex-direction:column}}
  </style>
</head>
<body>
  <div class="card">
    <h1><i class="fas fa-exchange-alt"></i> Batch IP → Domain Resolver</h1>
    <p class="lead">Paste IPv4 or IPv6 addresses (one per line). The app performs reverse DNS (PTR) lookup.</p>

    <textarea id="input" placeholder="8.8.8.8
1.1.1.1
2606:4700:4700::1111"></textarea>

    <div class="controls">
      <select id="provider">
        <option value="google">Google DNS</option>
        <option value="cloudflare">Cloudflare DNS</option>
      </select>
      <button class="primary" id="resolveBtn"><i class="fas fa-search"></i> Resolve Domains</button>
      <button class="ghost" id="clearBtn"><i class="fas fa-trash"></i> Clear</button>
      <button class="ghost" id="copyDomains"><i class="fas fa-copy"></i> Copy Domains</button>
    </div>

    <div class="stats">
      <div class="stat"><b id="total">0</b>IPs</div>
      <div class="stat"><b id="resolved">0</b>Resolved</div>
      <div class="stat"><b id="errors">0</b>Errors</div>
    </div>

    <div class="results" style="margin-top:16px">
      <table>
        <thead>
          <tr><th style="width:30%">IP</th><th style="width:50%">Domain(s)</th><th>Status</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="alerts" id="alerts"></div>

<script>
const input=document.getElementById('input');
const tbody=document.getElementById('tbody');
const provider=document.getElementById('provider');
const totalEl=document.getElementById('total');
const resolvedEl=document.getElementById('resolved');
const errorsEl=document.getElementById('errors');
const alerts=document.getElementById('alerts');
let stats={total:0,resolved:0,errors:0};

function alertMsg(msg){const d=document.createElement('div');d.className='alert';d.textContent=msg;alerts.appendChild(d);setTimeout(()=>d.remove(),3500)}

function reset(){stats={total:0,resolved:0,errors:0};updateStats()}
function updateStats(){totalEl.textContent=stats.total;resolvedEl.textContent=stats.resolved;errorsEl.textContent=stats.errors}

function parseIPs(raw){return [...new Set(raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean))]}

function ptrName(ip){
  if(ip.includes(':')){
    return ip.replace(/:/g,'').split('').reverse().join('.')+'.ip6.arpa';
  }
  return ip.split('.').reverse().join('.')+'.in-addr.arpa';
}

async function dohPTR(ip){
  const name=ptrName(ip);
  let url=provider.value==='cloudflare'
    ? `https://cloudflare-dns.com/dns-query?name=${name}&type=PTR`
    : `https://dns.google/resolve?name=${name}&type=PTR`;
  const r=await fetch(url,{headers: provider.value==='cloudflare'?{'Accept':'application/dns-json'}:{}});
  if(!r.ok) throw new Error('dns');
  const j=await r.json();
  const ans=j.Answer||[];
  return ans.map(a=>a.data.replace(/\.$/,''));
}

function addRow(ip){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${ip}</td><td>…</td><td class="status">resolving</td>`;
  tbody.appendChild(tr);return tr;
}

async function resolveIP(ip,tr){
  try{
    const domains=await dohPTR(ip);
    if(domains.length===0) throw new Error('no ptr');
    tr.children[1].innerHTML=domains.map(d=>`<span class="pill">${d}</span>`).join('');
    tr.children[2].innerHTML='<span class="status ok"><i class="fas fa-check"></i> ok</span>';
    stats.resolved++;
  }catch(e){
    tr.children[1].textContent='—';
    tr.children[2].innerHTML='<span class="status err"><i class="fas fa-times"></i> failed</span>';
    stats.errors++;
  }
  updateStats();
}

resolveBtn.onclick=async()=>{
  const ips=parseIPs(input.value);
  if(!ips.length){alertMsg('Paste IP addresses first');return}
  tbody.innerHTML='';reset();stats.total=ips.length;updateStats();
  alertMsg('Resolving '+ips.length+' IPs…');
  const rows=ips.map(ip=>({ip,tr:addRow(ip)}));
  let i=0;const conc=6;
  async function worker(){while(i<rows.length){const c=rows[i++];await resolveIP(c.ip,c.tr)}}
  await Promise.all(Array(Math.min(conc,rows.length)).fill(0).map(worker));
  alertMsg('Done');
}

clearBtn.onclick=()=>{input.value='';tbody.innerHTML='';reset();alertMsg('Cleared')}
copyDomains.onclick=()=>{
  const doms=[...tbody.querySelectorAll('.pill')].map(p=>p.textContent);
  if(!doms.length){alertMsg('No domains');return}
  navigator.clipboard.writeText([...new Set(doms)].join('\n'));alertMsg('Domains copied');
}
</script>
</body>
</html>
